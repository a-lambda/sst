[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Fichiers NetCDF",
    "section": "",
    "text": "Preface"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "\n1  Introduction\n",
    "section": "",
    "text": "This is a book created from markdown and executable code.\nSee Knuth (1984) for additional discussion of literate programming.\n\n1 + 1\n\n[1] 2\n\n\n\n\n\n\nKnuth, Donald E. 1984. “Literate Programming.” Comput. J. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  },
  {
    "objectID": "oisst.html",
    "href": "oisst.html",
    "title": "\n2  OISST\n",
    "section": "",
    "text": "Chargement de packages nécessaires\n\n\nhttr pour le téléchargement des fichiers de données\n\ntidyverse pour les fonctionnalités offertes par\n\n\nggplot2,\n\nlubridate pour la gestion du temps,\n\npurrr, entre autres.\n\n\n\nterra,\n\nncdf4 pour la gestion des fichiers NetCDF,\n\ntictoc pour des tests de vitesse\n\n\nlibs &lt;- c(\n  \"httr\",\n  \"tidyverse\",\n  \"terra\",\n  \"ncdf4\",\n  \"tictoc\"\n)\n\n#install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))\n\nComptage des fichiers exploitables\nLes fichiers de données exploitables sont les fichiers ne comportant le suffixe “.nc”. Les fichiers de données en cours de finalisation comportent le suffixe “_preliminary.nc”. Le premier fichier NetCDF exploitable date du 1er septembre 1981. En date du Sys.Date() nous allons déterminer quel est le dernier fichier exploitable.\n\nyyyymm &lt;- function(date) { # transform Date '1981-06-25' to string '198106' \n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  paste0(annee, if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)))\n}\n\nyyyymmdd &lt;- function(date) { # transform Date '1981-06-25' to string '19810625'\n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  jour &lt;- day(date)\n  paste0(\n    annee,\n    if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)),\n    if_else(jour &gt; 9, as.character(jour), paste0(\"0\", jour))\n  )\n}\n\nsst_file_link &lt;- function(date, ready = TRUE) {\n  chaine_matrice &lt;- ifelse(\n    ready, \n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\",\n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&_preliminary.nc\"\n  )\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_last_valid_sst_date &lt;- function() {\n  valide &lt;- FALSE\n  date &lt;- Sys.Date() - 2 # to be sure to have a preliminary file to test\n  while (!valide) {\n    message(date)\n    if (status_code(GET(sst_file_link(date, ready = FALSE))) == 200) {\n      date &lt;- date - 1\n    } else {\n      if (status_code(GET(sst_file_link(date, ready = TRUE))) == 200) {\n        valide &lt;- TRUE\n      }\n    }\n  }\n  date\n}\n\nlast_valid_sst_date &lt;- get_last_valid_sst_date()\n\n2024-01-27\n\n\n2024-01-26\n\n\n2024-01-25\n\n\n2024-01-24\n\n\n2024-01-23\n\n\n2024-01-22\n\n\n2024-01-21\n\n\n2024-01-20\n\n\n2024-01-19\n\n\n2024-01-18\n\n\n2024-01-17\n\n\n2024-01-16\n\n\n2024-01-15\n\n\n2024-01-14\n\npaste0(\"last valid sst date : \", last_valid_sst_date)\n\n[1] \"last valid sst date : 2024-01-14\"\n\nstart_date &lt;- ymd(\"1981-09-01\") # date for the first sst file\n\nnumber_of_sst_files &lt;- interval(start_date, last_valid_sst_date) %/% days(1) + 1\npaste0(\"number of sst files to consider : \", number_of_sst_files)\n\n[1] \"number of sst files to consider : 15476\"\n\n\nDownloading the data files\n\nseq_days &lt;- seq(\n  start_date,\n  last_valid_sst_date,\n  by = \"days\"\n)\n\n# liste des fichiers à télécharger\n\nroot_access &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr\"\nstring1 &lt;- yyyymm(seq_days)\nfile_prefixe &lt;- \"oisst-avhrr-v02r01\"\nfile_suffixe &lt;- \"nc\"\nstring2 &lt;- yyyymmdd(seq_days)\n\nseq_oisst_files &lt;- paste(root_access, string1, paste(file_prefixe, string2, file_suffixe, sep = \".\"), sep = \"/\")\n\n# téléchargement de tous les fichiers depuis la date d'origine des mesures\n# \nsst_file_link &lt;- function(date) {\n  chaine_matrice &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\"\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_oisst_data &lt;- function(date) {\n  link &lt;- sst_file_link(date)\n  link_split &lt;- strsplit(link, '/')[[1]]\n  file_name &lt;- link_split[length(link_split)]\n  file_to_write &lt;- paste(\"DATA\", file_name, sep = \"/\")\n  if (!file.exists(file_to_write)) {\n    message(file_name)\n    res &lt;- httr::GET(\n      link,\n      write_disk(\n        file_to_write,\n        overwrite = TRUE\n      ),\n    progress()\n    )\n  }\n}\n\nwalk(seq_days, get_oisst_data)\n\nVisite d’un fichier netCDF (exemple trouvé ici)\n\n# open netCDF file\nnc &lt;- nc_open(\"DATA/oisst-avhrr-v02r01.20240106.nc\")\n\n\n# get info about latitudes\nlat &lt;- ncvar_get(nc, \"lat\")\nlat_units &lt;- ncatt_get(nc, \"lat\", \"units\")\n# get info about longitudes\nlon &lt;- ncvar_get(nc, \"lon\")\nlon_units &lt;- ncatt_get(nc, \"lon\", \"units\")\n# get info about time\ntime &lt;- ncvar_get(nc, \"time\")\ntime_units &lt;- ncatt_get(nc, \"time\", \"units\")\ntime_as_date &lt;- as.Date(time, origin = \"1978-01-01 12:00:0\", tz = \"UTC\")\n# get info about zlev\nzlev &lt;- ncvar_get(nc, \"zlev\")\nzlev_units &lt;- ncatt_get(nc, \"zlev\", \"units\")\n\n\nnc_var &lt;- names(nc$var)\nprint(paste(\"Variables disponibles :\", paste(nc_var, collapse = ',')))\n\n[1] \"Variables disponibles : sst,anom,err,ice\"\n\n# get info about variable attribute\nget_var_attribute &lt;- function(var, attribute) {\n  nc_var &lt;- names(nc$var)\n  if (!(var %in% nc_var)) {\n    message(paste(\"la variable\", var, \"est inexistante\"))\n  } else {\n  ln &lt;- ncatt_get(nc, var, attname = attribute)\n  ifelse(ln$hasatt, ln$value, paste(\"pas d'attribut \", attribute))\n  }\n}\n\n# long names\nget_var_long_name &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"long_name\"\n  )\n}\nprint(get_var_long_name())\n\n                                                 sst \n                     \"Daily sea surface temperature\" \n                                                anom \n           \"Daily sea surface temperature anomalies\" \n                                                 err \n\"Estimated error standard deviation of analysed_sst\" \n                                                 ice \n                             \"Sea ice concentration\" \n\n# source\nget_var_units &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"units\"\n  )\n}\nprint(get_var_units())\n\n      sst      anom       err       ice \n\"Celsius\" \"Celsius\" \"Celsius\"       \"%\" \n\n# fill value\nget_var_fill_value &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = numeric(1), \n  \"_FillValue\"\n  )\n}\nprint(get_var_fill_value())\n\n sst anom  err  ice \n-999 -999 -999 -999 \n\n\n\natt &lt;- c(\"title\", \"institution\", \"source\", \"references\", \"history\", \"Conventions\") \nget_global_attribute &lt;- function(att) {\n  ncatt_get(nc, 0, att)$value\n}\nglobal_attributes &lt;- vapply(att, get_global_attribute, FUN.VALUE = character(1))\nprint(global_attributes)\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \"NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  institution \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \"NOAA/National Centers for Environmental Information\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       source \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \"ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   references \n\"Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \"Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Conventions \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \"CF-1.6, ACDD-1.3\" \n\n\n\nnc_var &lt;- names(nc$var)\n\nnc_charge_var &lt;- function(var) {\n  nc_var &lt;- ncvar_get(nc = nc, varid = var )\n  envir &lt;- globalenv()\n  assign(var, nc_var, envir = envir)\n}\n\nwalk(nc_var, nc_charge_var)\n\n\nlonlat &lt;- expand.grid(lon, lat)\ntmp_sst &lt;- as.vector(sst)\ndf_sst &lt;- cbind(lonlat, tmp_sst)\nnames(df_sst) &lt;- c(\"lon\", \"lat\", \"sst\")\nhead(df_sst)\n\n    lon     lat sst\n1 0.125 -89.875  NA\n2 0.375 -89.875  NA\n3 0.625 -89.875  NA\n4 0.875 -89.875  NA\n5 1.125 -89.875  NA\n6 1.375 -89.875  NA\n\ndf_sst |&gt; \n  ggplot(aes(x = lon, y = lat, color = sst)) + geom_point(size = 0.5)\n\n\n\n\n\nlist_raster &lt;- map(nc_var, \\(x) rast(t(get(x))))\n\n\nwalk(list_raster, \\(x) plot(flip(x, direction = \"vertical\")))"
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "\n3  Summary\n",
    "section": "",
    "text": "In summary, this book has no content whatsoever.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Knuth, Donald E. 1984. “Literate Programming.” Comput.\nJ. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  },
  {
    "objectID": "intro.html#présentation-des-données-exploitées",
    "href": "intro.html#présentation-des-données-exploitées",
    "title": "1  Introduction",
    "section": "1.1 Présentation des données exploitées",
    "text": "1.1 Présentation des données exploitées\nLe NOAA1 présente au travail du portail du NCEI2 un ensemble de données environnementales.\nNous allons ici considérer les relevés quotidiens de la température de surface de l’eau de mer au niveau mondial.\nLes données brutes recensées par différentes sondes (satellites, navires, bouées) sur un maillage régulier de 0,25° par 0,25° sont combinées et les lacunes sont comblées par interpolation.\nCes données traitées sont ensuite mises à disposition sur le site de la NOAA sour forme de fichiers NetCDF.\nElles sont accessibles ici sous la rubrique sea-surface-temperature-optimum-interpolation\nDes informations complémentaires sur cet ensemble de données sont disponibles ici.\nNous allons tenter de générer le même type de graphes temporels que ceux disponibles sur le site de Climate Reanalyzer et accessibles sur la page Daily Sea Surface Temperature."
  },
  {
    "objectID": "intro.html#footnotes",
    "href": "intro.html#footnotes",
    "title": "1  Introduction",
    "section": "",
    "text": "National Oceanic and Atmospheric Administration↩︎\nNational Centers for Environmental Information↩︎"
  },
  {
    "objectID": "oisst.html#chargement-de-packages-nécessaires",
    "href": "oisst.html#chargement-de-packages-nécessaires",
    "title": "\n2  OISST\n",
    "section": "\n2.1 Chargement de packages nécessaires",
    "text": "2.1 Chargement de packages nécessaires\n\n\nhttr pour le téléchargement des fichiers de données\n\ntidyverse pour les fonctionnalités offertes par\n\n\nggplot2,\n\nlubridate pour la gestion du temps,\n\npurrr, entre autres.\n\n\n\nterra,\n\nncdf4 pour la gestion des fichiers NetCDF,\n\ntictoc pour des tests de vitesse\n\n\nlibs &lt;- c(\n  \"httr\",\n  \"tidyverse\",\n  \"terra\",\n  \"ncdf4\",\n  \"tictoc\"\n)\n\n#install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))"
  },
  {
    "objectID": "oisst.html#comptage-des-fichiers-exploitables",
    "href": "oisst.html#comptage-des-fichiers-exploitables",
    "title": "\n2  OISST\n",
    "section": "\n2.2 Comptage des fichiers exploitables",
    "text": "2.2 Comptage des fichiers exploitables\nLes fichiers de données exploitables sont les fichiers ne comportant le suffixe “.nc”. Les fichiers de données en cours de finalisation comportent le suffixe “_preliminary.nc”. Le premier fichier NetCDF exploitable date du 1er septembre 1981. En date du Sys.Date() nous allons déterminer quel est le dernier fichier exploitable.\n\nyyyymm &lt;- function(date) { # transform Date '1981-06-25' to string '198106' \n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  paste0(annee, if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)))\n}\n\nyyyymmdd &lt;- function(date) { # transform Date '1981-06-25' to string '19810625'\n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  jour &lt;- day(date)\n  paste0(\n    annee,\n    if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)),\n    if_else(jour &gt; 9, as.character(jour), paste0(\"0\", jour))\n  )\n}\n\nsst_file_link &lt;- function(date, ready = TRUE) {\n  chaine_matrice &lt;- ifelse(\n    ready, \n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\",\n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&_preliminary.nc\"\n  )\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_last_valid_sst_date &lt;- function() {\n  valide &lt;- FALSE\n  date &lt;- Sys.Date() - 2 # to be sure to have a preliminary file to test\n  while (!valide) {\n    if (status_code(GET(sst_file_link(date, ready = FALSE))) == 200) {\n      date &lt;- date - 1\n    } else {\n      if (status_code(GET(sst_file_link(date, ready = TRUE))) == 200) {\n        valide &lt;- TRUE\n      }\n    }\n  }\n  date\n}\n\nlast_valid_sst_date &lt;- get_last_valid_sst_date()\npaste0(\"last valid sst date : \", last_valid_sst_date)\n\n[1] \"last valid sst date : 2024-01-15\"\n\nstart_date &lt;- ymd(\"1981-09-01\") # date for the first sst file\n\nnumber_of_sst_files &lt;- interval(start_date, last_valid_sst_date) %/% days(1) + 1\npaste0(\"number of sst files to consider : \", number_of_sst_files)\n\n[1] \"number of sst files to consider : 15477\""
  },
  {
    "objectID": "oisst.html#téléchargement-des-fichiers-de-données",
    "href": "oisst.html#téléchargement-des-fichiers-de-données",
    "title": "\n2  OISST\n",
    "section": "\n2.3 Téléchargement des fichiers de données",
    "text": "2.3 Téléchargement des fichiers de données\n\nseq_days &lt;- seq(\n  start_date,\n  last_valid_sst_date,\n  by = \"days\"\n)\n\n# liste des fichiers à télécharger\n\nroot_access &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr\"\nstring1 &lt;- yyyymm(seq_days)\nfile_prefixe &lt;- \"oisst-avhrr-v02r01\"\nfile_suffixe &lt;- \"nc\"\nstring2 &lt;- yyyymmdd(seq_days)\n\nseq_oisst_files &lt;- paste(root_access, string1, paste(file_prefixe, string2, file_suffixe, sep = \".\"), sep = \"/\")\n\n# téléchargement de tous les fichiers depuis la date d'origine des mesures\n# \nsst_file_link &lt;- function(date) {\n  chaine_matrice &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\"\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_oisst_data &lt;- function(date) {\n  link &lt;- sst_file_link(date)\n  link_split &lt;- strsplit(link, '/')[[1]]\n  file_name &lt;- link_split[length(link_split)]\n  file_to_write &lt;- paste(\"DATA\", file_name, sep = \"/\")\n  if (!file.exists(file_to_write)) {\n    res &lt;- httr::GET(\n      link,\n      write_disk(\n        file_to_write,\n        overwrite = TRUE\n      ),\n    progress()\n    )\n  }\n}\n\nwalk(seq_days, get_oisst_data)"
  },
  {
    "objectID": "oisst.html#exploration-du-fichier-netcdf-du-15-janvier-2024-comme-décrit-ici",
    "href": "oisst.html#exploration-du-fichier-netcdf-du-15-janvier-2024-comme-décrit-ici",
    "title": "\n2  OISST\n",
    "section": "\n2.4 Exploration du fichier NetCDF du 15 janvier 2024 (comme décrit ici)",
    "text": "2.4 Exploration du fichier NetCDF du 15 janvier 2024 (comme décrit ici)\n\n(nc &lt;- nc_open(\"DATA/oisst-avhrr-v02r01.20240115.nc\"))\n\nFile DATA/oisst-avhrr-v02r01.20240115.nc (NC_FORMAT_NETCDF4):\n\n     4 variables (excluding dimension variables):\n        short sst[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -300\n            valid_max: 4500\n        short anom[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature anomalies\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -1200\n            valid_max: 1200\n        short err[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Estimated error standard deviation of analysed_sst\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 1000\n        short ice[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Sea ice concentration\n            units: %\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 100\n\n     4 dimensions:\n        time  Size:1   *** is unlimited *** \n            long_name: Center time of the day\n            units: days since 1978-01-01 12:00:00\n        zlev  Size:1 \n            long_name: Sea surface height\n            units: meters\n            positive: down\n            actual_range: 0, 0\n        lat  Size:720 \n            long_name: Latitude\n            units: degrees_north\n            grids: Uniform grid from -89.875 to 89.875 by 0.25\n        lon  Size:1440 \n            long_name: Longitude\n            units: degrees_east\n            grids: Uniform grid from 0.125 to 359.875 by 0.25\n\n    37 global attributes:\n        Conventions: CF-1.6, ACDD-1.3\n        title: NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\n        references: Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\n        source: ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\n        id: oisst-avhrr-v02r01.20240115.nc\n        naming_authority: gov.noaa.ncei\n        summary: NOAAs 1/4-degree Daily Optimum Interpolation Sea Surface Temperature (OISST) (sometimes referred to as Reynolds SST, which however also refers to earlier products at different resolution), currently available as version v02r01, is created by interpolating and extrapolating SST observations from different sources, resulting in a smoothed complete field. The sources of data are satellite (AVHRR) and in situ platforms (i.e., ships and buoys), and the specific datasets employed may change over time. At the marginal ice zone, sea ice concentrations are used to generate proxy SSTs.  A preliminary version of this file is produced in near-real time (1-day latency), and then replaced with a final version after 2 weeks. Note that this is the AVHRR-ONLY DOISST, available from Oct 1981, but there is a companion DOISST product that includes microwave satellite data, available from June 2002\n        cdm_data_type: Grid\n        history: Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\n        date_modified: 2024-01-30T09:12:00Z\n        date_created: 2024-01-30T09:12:00Z\n        product_version: Version v02r01\n        processing_level: NOAA Level 4\n        institution: NOAA/National Centers for Environmental Information\n        creator_url: https://www.ncei.noaa.gov/\n        creator_email: oisst-help@noaa.gov\n        keywords: Earth Science &gt; Oceans &gt; Ocean Temperature &gt; Sea Surface Temperature\n        keywords_vocabulary: Global Change Master Directory (GCMD) Earth Science Keywords\n        platform: Ships, buoys, Argo floats, MetOp-A, MetOp-B\n        platform_vocabulary: Global Change Master Directory (GCMD) Platform Keywords\n        instrument: Earth Remote Sensing Instruments &gt; Passive Remote Sensing &gt; Spectrometers/Radiometers &gt; Imaging Spectrometers/Radiometers &gt; AVHRR &gt; Advanced Very High Resolution Radiometer\n        instrument_vocabulary: Global Change Master Directory (GCMD) Instrument Keywords\n        standard_name_vocabulary: CF Standard Name Table (v40, 25 January 2017)\n        geospatial_lat_min: -90\n        geospatial_lat_max: 90\n        geospatial_lon_min: 0\n        geospatial_lon_max: 360\n        geospatial_lat_units: degrees_north\n        geospatial_lat_resolution: 0.25\n        geospatial_lon_units: degrees_east\n        geospatial_lon_resolution: 0.25\n        time_coverage_start: 2024-01-15T00:00:00Z\n        time_coverage_end: 2024-01-15T23:59:59Z\n        metadata_link: https://doi.org/10.25921/RE9P-PT57\n        ncei_template_version: NCEI_NetCDF_Grid_Template_v2.0\n        comment: Data was converted from NetCDF-3 to NetCDF-4 format with metadata updates in November 2017.\n        sensor: Thermometer, AVHRR\n\n\n\n# get info about latitudes\nlat &lt;- ncvar_get(nc, \"lat\")\nlat_units &lt;- ncatt_get(nc, \"lat\", \"units\")\n# get info about longitudes\nlon &lt;- ncvar_get(nc, \"lon\")\nlon_units &lt;- ncatt_get(nc, \"lon\", \"units\")\n# get info about time\ntime &lt;- ncvar_get(nc, \"time\")\ntime_units &lt;- ncatt_get(nc, \"time\", \"units\")\ntime_as_date &lt;- as.Date(time, origin = \"1978-01-01 12:00:0\", tz = \"UTC\")\n# get info about zlev\nzlev &lt;- ncvar_get(nc, \"zlev\")\nzlev_units &lt;- ncatt_get(nc, \"zlev\", \"units\")\n\n\nnc_var &lt;- names(nc$var)\nprint(paste(\"Variables disponibles :\", paste(nc_var, collapse = ',')))\n\n[1] \"Variables disponibles : sst,anom,err,ice\"\n\n# get info about variable attribute\nget_var_attribute &lt;- function(var, attribute) {\n  nc_var &lt;- names(nc$var)\n  if (!(var %in% nc_var)) {\n    message(paste(\"la variable\", var, \"est inexistante\"))\n  } else {\n  ln &lt;- ncatt_get(nc, var, attname = attribute)\n  ifelse(ln$hasatt, ln$value, paste(\"pas d'attribut \", attribute))\n  }\n}\n\n# long names\nget_var_long_name &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"long_name\"\n  )\n}\nprint(get_var_long_name())\n\n                                                 sst \n                     \"Daily sea surface temperature\" \n                                                anom \n           \"Daily sea surface temperature anomalies\" \n                                                 err \n\"Estimated error standard deviation of analysed_sst\" \n                                                 ice \n                             \"Sea ice concentration\" \n\n# source\nget_var_units &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"units\"\n  )\n}\nprint(get_var_units())\n\n      sst      anom       err       ice \n\"Celsius\" \"Celsius\" \"Celsius\"       \"%\" \n\n# fill value\nget_var_fill_value &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = numeric(1), \n  \"_FillValue\"\n  )\n}\nprint(get_var_fill_value())\n\n sst anom  err  ice \n-999 -999 -999 -999 \n\n\n\natt &lt;- c(\"title\", \"institution\", \"source\", \"references\", \"history\", \"Conventions\") \nget_global_attribute &lt;- function(att) {\n  ncatt_get(nc, 0, att)$value\n}\nglobal_attributes &lt;- vapply(att, get_global_attribute, FUN.VALUE = character(1))\nprint(global_attributes)\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \"NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  institution \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \"NOAA/National Centers for Environmental Information\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       source \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \"ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   references \n\"Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \"Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Conventions \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \"CF-1.6, ACDD-1.3\" \n\n\n\nnc_var &lt;- names(nc$var)\n\nnc_charge_var &lt;- function(var) {\n  nc_var &lt;- ncvar_get(nc = nc, varid = var )\n  envir &lt;- globalenv()\n  assign(var, nc_var, envir = envir)\n}\n\nwalk(nc_var, nc_charge_var)\n\n\nlonlat &lt;- expand.grid(lon, lat)\ntmp_sst &lt;- as.vector(sst)\ndf_sst &lt;- cbind(lonlat, tmp_sst)\nnames(df_sst) &lt;- c(\"lon\", \"lat\", \"sst\")\nhead(df_sst)\n\n    lon     lat sst\n1 0.125 -89.875  NA\n2 0.375 -89.875  NA\n3 0.625 -89.875  NA\n4 0.875 -89.875  NA\n5 1.125 -89.875  NA\n6 1.375 -89.875  NA\n\ndf_sst |&gt; \n  ggplot(aes(x = lon, y = lat, color = sst)) + geom_point(size = 0.5)\n\n\n\n\n\nlist_raster &lt;- map(nc_var, \\(x) rast(t(get(x))))\n\n\nwalk(list_raster, \\(x) plot(flip(x, direction = \"vertical\")))"
  },
  {
    "objectID": "sst_example.html#exploration-du-fichier-netcdf-du-15-janvier-2024-comme-décrit-ici",
    "href": "sst_example.html#exploration-du-fichier-netcdf-du-15-janvier-2024-comme-décrit-ici",
    "title": "\n3  Données SST du 15 janvier 2024\n",
    "section": "\n3.1 Exploration du fichier NetCDF du 15 janvier 2024 (comme décrit ici)",
    "text": "3.1 Exploration du fichier NetCDF du 15 janvier 2024 (comme décrit ici)\n\nlibs &lt;- c(\n  \"ncdf4\",\n  \"tidyverse\",\n  \"terra\"\n)\n\n#install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))\n\n\n(nc &lt;- nc_open(\"DATA/oisst-avhrr-v02r01.20240115.nc\"))\n\nFile DATA/oisst-avhrr-v02r01.20240115.nc (NC_FORMAT_NETCDF4):\n\n     4 variables (excluding dimension variables):\n        short sst[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -300\n            valid_max: 4500\n        short anom[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature anomalies\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -1200\n            valid_max: 1200\n        short err[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Estimated error standard deviation of analysed_sst\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 1000\n        short ice[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Sea ice concentration\n            units: %\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 100\n\n     4 dimensions:\n        time  Size:1   *** is unlimited *** \n            long_name: Center time of the day\n            units: days since 1978-01-01 12:00:00\n        zlev  Size:1 \n            long_name: Sea surface height\n            units: meters\n            positive: down\n            actual_range: 0, 0\n        lat  Size:720 \n            long_name: Latitude\n            units: degrees_north\n            grids: Uniform grid from -89.875 to 89.875 by 0.25\n        lon  Size:1440 \n            long_name: Longitude\n            units: degrees_east\n            grids: Uniform grid from 0.125 to 359.875 by 0.25\n\n    37 global attributes:\n        Conventions: CF-1.6, ACDD-1.3\n        title: NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\n        references: Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\n        source: ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\n        id: oisst-avhrr-v02r01.20240115.nc\n        naming_authority: gov.noaa.ncei\n        summary: NOAAs 1/4-degree Daily Optimum Interpolation Sea Surface Temperature (OISST) (sometimes referred to as Reynolds SST, which however also refers to earlier products at different resolution), currently available as version v02r01, is created by interpolating and extrapolating SST observations from different sources, resulting in a smoothed complete field. The sources of data are satellite (AVHRR) and in situ platforms (i.e., ships and buoys), and the specific datasets employed may change over time. At the marginal ice zone, sea ice concentrations are used to generate proxy SSTs.  A preliminary version of this file is produced in near-real time (1-day latency), and then replaced with a final version after 2 weeks. Note that this is the AVHRR-ONLY DOISST, available from Oct 1981, but there is a companion DOISST product that includes microwave satellite data, available from June 2002\n        cdm_data_type: Grid\n        history: Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\n        date_modified: 2024-01-30T09:12:00Z\n        date_created: 2024-01-30T09:12:00Z\n        product_version: Version v02r01\n        processing_level: NOAA Level 4\n        institution: NOAA/National Centers for Environmental Information\n        creator_url: https://www.ncei.noaa.gov/\n        creator_email: oisst-help@noaa.gov\n        keywords: Earth Science &gt; Oceans &gt; Ocean Temperature &gt; Sea Surface Temperature\n        keywords_vocabulary: Global Change Master Directory (GCMD) Earth Science Keywords\n        platform: Ships, buoys, Argo floats, MetOp-A, MetOp-B\n        platform_vocabulary: Global Change Master Directory (GCMD) Platform Keywords\n        instrument: Earth Remote Sensing Instruments &gt; Passive Remote Sensing &gt; Spectrometers/Radiometers &gt; Imaging Spectrometers/Radiometers &gt; AVHRR &gt; Advanced Very High Resolution Radiometer\n        instrument_vocabulary: Global Change Master Directory (GCMD) Instrument Keywords\n        standard_name_vocabulary: CF Standard Name Table (v40, 25 January 2017)\n        geospatial_lat_min: -90\n        geospatial_lat_max: 90\n        geospatial_lon_min: 0\n        geospatial_lon_max: 360\n        geospatial_lat_units: degrees_north\n        geospatial_lat_resolution: 0.25\n        geospatial_lon_units: degrees_east\n        geospatial_lon_resolution: 0.25\n        time_coverage_start: 2024-01-15T00:00:00Z\n        time_coverage_end: 2024-01-15T23:59:59Z\n        metadata_link: https://doi.org/10.25921/RE9P-PT57\n        ncei_template_version: NCEI_NetCDF_Grid_Template_v2.0\n        comment: Data was converted from NetCDF-3 to NetCDF-4 format with metadata updates in November 2017.\n        sensor: Thermometer, AVHRR\n\n\n\n# get info about latitudes\nlat &lt;- ncvar_get(nc, \"lat\")\nlat_units &lt;- ncatt_get(nc, \"lat\", \"units\")\n# get info about longitudes\nlon &lt;- ncvar_get(nc, \"lon\")\nlon_units &lt;- ncatt_get(nc, \"lon\", \"units\")\n# get info about time\ntime &lt;- ncvar_get(nc, \"time\")\ntime_units &lt;- ncatt_get(nc, \"time\", \"units\")\ntime_as_date &lt;- as.Date(time, origin = \"1978-01-01 12:00:0\", tz = \"UTC\")\n# get info about zlev\nzlev &lt;- ncvar_get(nc, \"zlev\")\nzlev_units &lt;- ncatt_get(nc, \"zlev\", \"units\")\n\n\nnc_var &lt;- names(nc$var)\nprint(paste(\"Variables disponibles :\", paste(nc_var, collapse = ',')))\n\n[1] \"Variables disponibles : sst,anom,err,ice\"\n\n# get info about variable attribute\nget_var_attribute &lt;- function(var, attribute) {\n  nc_var &lt;- names(nc$var)\n  if (!(var %in% nc_var)) {\n    message(paste(\"la variable\", var, \"est inexistante\"))\n  } else {\n  ln &lt;- ncatt_get(nc, var, attname = attribute)\n  ifelse(ln$hasatt, ln$value, paste(\"pas d'attribut \", attribute))\n  }\n}\n\n# long names\nget_var_long_name &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"long_name\"\n  )\n}\nprint(get_var_long_name())\n\n                                                 sst \n                     \"Daily sea surface temperature\" \n                                                anom \n           \"Daily sea surface temperature anomalies\" \n                                                 err \n\"Estimated error standard deviation of analysed_sst\" \n                                                 ice \n                             \"Sea ice concentration\" \n\n# source\nget_var_units &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"units\"\n  )\n}\nprint(get_var_units())\n\n      sst      anom       err       ice \n\"Celsius\" \"Celsius\" \"Celsius\"       \"%\" \n\n# fill value\nget_var_fill_value &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = numeric(1), \n  \"_FillValue\"\n  )\n}\nprint(get_var_fill_value())\n\n sst anom  err  ice \n-999 -999 -999 -999 \n\n\n\natt &lt;- c(\"title\", \"institution\", \"source\", \"references\", \"history\", \"Conventions\") \nget_global_attribute &lt;- function(att) {\n  ncatt_get(nc, 0, att)$value\n}\nglobal_attributes &lt;- vapply(att, get_global_attribute, FUN.VALUE = character(1))\nprint(global_attributes)\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \"NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  institution \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \"NOAA/National Centers for Environmental Information\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       source \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \"ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   references \n\"Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \"Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Conventions \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \"CF-1.6, ACDD-1.3\" \n\n\n\nnc_var &lt;- names(nc$var)\n\nnc_charge_var &lt;- function(var) {\n  nc_var &lt;- ncvar_get(nc = nc, varid = var )\n  envir &lt;- globalenv()\n  assign(var, nc_var, envir = envir)\n}\n\nwalk(nc_var, nc_charge_var)\n\n\nlonlat &lt;- expand.grid(lon, lat)\ntmp_sst &lt;- as.vector(sst)\ndf_sst &lt;- cbind(lonlat, tmp_sst)\nnames(df_sst) &lt;- c(\"lon\", \"lat\", \"sst\")\nhead(df_sst)\n\n    lon     lat sst\n1 0.125 -89.875  NA\n2 0.375 -89.875  NA\n3 0.625 -89.875  NA\n4 0.875 -89.875  NA\n5 1.125 -89.875  NA\n6 1.375 -89.875  NA\n\ndf_sst |&gt; \n  ggplot(aes(x = lon, y = lat, color = sst)) + geom_point(size = 0.5)\n\n\n\n\n\nlist_raster &lt;- map(nc_var, \\(x) rast(t(get(x))))\n\n\nwalk(list_raster, \\(x) plot(flip(x, direction = \"vertical\")))"
  },
  {
    "objectID": "sst_dl.html#chargement-de-packages-nécessaires",
    "href": "sst_dl.html#chargement-de-packages-nécessaires",
    "title": "\n2  Récupération des données SST\n",
    "section": "\n2.1 Chargement de packages nécessaires",
    "text": "2.1 Chargement de packages nécessaires\n\n\nhttr pour le téléchargement des fichiers de données\n\ntidyverse pour les fonctionnalités offertes par\n\n\nggplot2,\n\nlubridate pour la gestion du temps,\n\npurrr, entre autres.\n\n\n\nterra,\n\nncdf4 pour la gestion des fichiers NetCDF,\n\n\nlibs &lt;- c(\n  \"httr\",\n  \"tidyverse\"\n)\n\n#install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))"
  },
  {
    "objectID": "sst_dl.html#comptage-des-fichiers-exploitables",
    "href": "sst_dl.html#comptage-des-fichiers-exploitables",
    "title": "\n2  Récupération des données SST\n",
    "section": "\n2.2 Comptage des fichiers exploitables",
    "text": "2.2 Comptage des fichiers exploitables\nLes fichiers de données exploitables sont les fichiers ne comportant le suffixe “.nc”. Les fichiers de données en cours de finalisation comportent le suffixe “_preliminary.nc”. Le premier fichier NetCDF exploitable date du 1er septembre 1981. En date du Sys.Date() nous allons déterminer quel est le dernier fichier exploitable.\n\nyyyymm &lt;- function(date) { # transform Date '1981-06-25' to string '198106' \n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  paste0(annee, if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)))\n}\n\nyyyymmdd &lt;- function(date) { # transform Date '1981-06-25' to string '19810625'\n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  jour &lt;- day(date)\n  paste0(\n    annee,\n    if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)),\n    if_else(jour &gt; 9, as.character(jour), paste0(\"0\", jour))\n  )\n}\n\nsst_file_link &lt;- function(date, ready = TRUE) {\n  chaine_matrice &lt;- ifelse(\n    ready, \n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\",\n    \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&_preliminary.nc\"\n  )\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_last_valid_sst_date &lt;- function() {\n  valide &lt;- FALSE\n  date &lt;- Sys.Date() - 2 # to be sure to have a preliminary file to test\n  while (!valide) {\n    if (status_code(GET(sst_file_link(date, ready = FALSE))) == 200) {\n      date &lt;- date - 1\n    } else {\n      if (status_code(GET(sst_file_link(date, ready = TRUE))) == 200) {\n        valide &lt;- TRUE\n      }\n    }\n  }\n  date\n}\n\nlast_valid_sst_date &lt;- get_last_valid_sst_date()\npaste0(\"last valid sst date : \", last_valid_sst_date)\n\n[1] \"last valid sst date : 2024-01-15\"\n\nstart_date &lt;- ymd(\"1981-09-01\") # date for the first sst file\n\nnumber_of_sst_files &lt;- interval(start_date, last_valid_sst_date) %/% days(1) + 1\npaste0(\"number of sst files to consider : \", number_of_sst_files)\n\n[1] \"number of sst files to consider : 15477\""
  },
  {
    "objectID": "sst_dl.html#téléchargement-des-fichiers-de-données",
    "href": "sst_dl.html#téléchargement-des-fichiers-de-données",
    "title": "\n2  Récupération des données SST\n",
    "section": "\n2.3 Téléchargement des fichiers de données",
    "text": "2.3 Téléchargement des fichiers de données\n\nseq_days &lt;- seq(\n  start_date,\n  last_valid_sst_date,\n  by = \"days\"\n)\n\n# liste des fichiers à télécharger\n\nroot_access &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr\"\nstring1 &lt;- yyyymm(seq_days)\nfile_prefixe &lt;- \"oisst-avhrr-v02r01\"\nfile_suffixe &lt;- \"nc\"\nstring2 &lt;- yyyymmdd(seq_days)\n\nseq_oisst_files &lt;- paste(root_access, string1, paste(file_prefixe, string2, file_suffixe, sep = \".\"), sep = \"/\")\n\n# téléchargement de tous les fichiers depuis la date d'origine des mesures\n# \nsst_file_link &lt;- function(date) {\n  chaine_matrice &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\"\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\nget_oisst_data &lt;- function(date) {\n  link &lt;- sst_file_link(date)\n  link_split &lt;- strsplit(link, '/')[[1]]\n  file_name &lt;- link_split[length(link_split)]\n  file_to_write &lt;- paste(\"DATA\", file_name, sep = \"/\")\n  if (!file.exists(file_to_write)) {\n    res &lt;- httr::GET(\n      link,\n      write_disk(\n        file_to_write,\n        overwrite = TRUE\n      ),\n    # progress()\n    )\n  }\n}\n\nwalk(seq_days, get_oisst_data)"
  },
  {
    "objectID": "sst_example.html#exploration-du-fichier-netcdf-comme-décrit-ici",
    "href": "sst_example.html#exploration-du-fichier-netcdf-comme-décrit-ici",
    "title": "\n3  Données SST du 15 janvier 2024\n",
    "section": "\n3.1 Exploration du fichier NetCDF (comme décrit ici)",
    "text": "3.1 Exploration du fichier NetCDF (comme décrit ici)\n\nlibs &lt;- c(\n  \"ncdf4\",\n  \"tidyverse\",\n  \"terra\"\n)\n\n#install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))\n\nLa connexion au fichier NetCDF s’opère via la commande nc_open.\nGrâce à elle nous pouvons déjà voir quel type d’informations sont enregistrées.\n\n(nc &lt;- nc_open(\"DATA/oisst-avhrr-v02r01.20240115.nc\"))\n\nFile DATA/oisst-avhrr-v02r01.20240115.nc (NC_FORMAT_NETCDF4):\n\n     4 variables (excluding dimension variables):\n        short sst[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -300\n            valid_max: 4500\n        short anom[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Daily sea surface temperature anomalies\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: -1200\n            valid_max: 1200\n        short err[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Estimated error standard deviation of analysed_sst\n            units: Celsius\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 1000\n        short ice[lon,lat,zlev,time]   (Chunking: [1440,720,1,1])  (Compression: shuffle,level 4)\n            long_name: Sea ice concentration\n            units: %\n            _FillValue: -999\n            add_offset: 0\n            scale_factor: 0.00999999977648258\n            valid_min: 0\n            valid_max: 100\n\n     4 dimensions:\n        time  Size:1   *** is unlimited *** \n            long_name: Center time of the day\n            units: days since 1978-01-01 12:00:00\n        zlev  Size:1 \n            long_name: Sea surface height\n            units: meters\n            positive: down\n            actual_range: 0, 0\n        lat  Size:720 \n            long_name: Latitude\n            units: degrees_north\n            grids: Uniform grid from -89.875 to 89.875 by 0.25\n        lon  Size:1440 \n            long_name: Longitude\n            units: degrees_east\n            grids: Uniform grid from 0.125 to 359.875 by 0.25\n\n    37 global attributes:\n        Conventions: CF-1.6, ACDD-1.3\n        title: NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\n        references: Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\n        source: ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\n        id: oisst-avhrr-v02r01.20240115.nc\n        naming_authority: gov.noaa.ncei\n        summary: NOAAs 1/4-degree Daily Optimum Interpolation Sea Surface Temperature (OISST) (sometimes referred to as Reynolds SST, which however also refers to earlier products at different resolution), currently available as version v02r01, is created by interpolating and extrapolating SST observations from different sources, resulting in a smoothed complete field. The sources of data are satellite (AVHRR) and in situ platforms (i.e., ships and buoys), and the specific datasets employed may change over time. At the marginal ice zone, sea ice concentrations are used to generate proxy SSTs.  A preliminary version of this file is produced in near-real time (1-day latency), and then replaced with a final version after 2 weeks. Note that this is the AVHRR-ONLY DOISST, available from Oct 1981, but there is a companion DOISST product that includes microwave satellite data, available from June 2002\n        cdm_data_type: Grid\n        history: Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\n        date_modified: 2024-01-30T09:12:00Z\n        date_created: 2024-01-30T09:12:00Z\n        product_version: Version v02r01\n        processing_level: NOAA Level 4\n        institution: NOAA/National Centers for Environmental Information\n        creator_url: https://www.ncei.noaa.gov/\n        creator_email: oisst-help@noaa.gov\n        keywords: Earth Science &gt; Oceans &gt; Ocean Temperature &gt; Sea Surface Temperature\n        keywords_vocabulary: Global Change Master Directory (GCMD) Earth Science Keywords\n        platform: Ships, buoys, Argo floats, MetOp-A, MetOp-B\n        platform_vocabulary: Global Change Master Directory (GCMD) Platform Keywords\n        instrument: Earth Remote Sensing Instruments &gt; Passive Remote Sensing &gt; Spectrometers/Radiometers &gt; Imaging Spectrometers/Radiometers &gt; AVHRR &gt; Advanced Very High Resolution Radiometer\n        instrument_vocabulary: Global Change Master Directory (GCMD) Instrument Keywords\n        standard_name_vocabulary: CF Standard Name Table (v40, 25 January 2017)\n        geospatial_lat_min: -90\n        geospatial_lat_max: 90\n        geospatial_lon_min: 0\n        geospatial_lon_max: 360\n        geospatial_lat_units: degrees_north\n        geospatial_lat_resolution: 0.25\n        geospatial_lon_units: degrees_east\n        geospatial_lon_resolution: 0.25\n        time_coverage_start: 2024-01-15T00:00:00Z\n        time_coverage_end: 2024-01-15T23:59:59Z\n        metadata_link: https://doi.org/10.25921/RE9P-PT57\n        ncei_template_version: NCEI_NetCDF_Grid_Template_v2.0\n        comment: Data was converted from NetCDF-3 to NetCDF-4 format with metadata updates in November 2017.\n        sensor: Thermometer, AVHRR\n\n\nLes dimensions\nles variables principales sont discriminées suivant plusieurs dimensions.\nIci, ce sont :\n\nlon : la longitude (de taille 1440)\nlat : la latitude (de taille 720)\nzlev : La hauteur de la surface de l’eau de mer\ntime : temps central de la journée\n\nIl est possible d’avoir accès aux données des dimensions via la fonction ncvar_get et l’accès aux attributs avec la fonction ncatt_get\n\n# get info about latitudes\nlat &lt;- ncvar_get(nc, \"lat\")\n(lat_units &lt;- ncatt_get(nc, \"lat\", \"units\"))\n\n$hasatt\n[1] TRUE\n\n$value\n[1] \"degrees_north\"\n\n# get info about longitudes\nlon &lt;- ncvar_get(nc, \"lon\")\n(lon_units &lt;- ncatt_get(nc, \"lon\", \"units\"))\n\n$hasatt\n[1] TRUE\n\n$value\n[1] \"degrees_east\"\n\n# get info about time\ntime &lt;- ncvar_get(nc, \"time\")\n(time_units &lt;- ncatt_get(nc, \"time\", \"units\"))\n\n$hasatt\n[1] TRUE\n\n$value\n[1] \"days since 1978-01-01 12:00:00\"\n\ntime_as_date &lt;- as.Date(time, origin = \"1978-01-01 12:00:0\", tz = \"UTC\")\n# get info about zlev\nzlev &lt;- ncvar_get(nc, \"zlev\")\n(zlev_units &lt;- ncatt_get(nc, \"zlev\", \"units\"))\n\n$hasatt\n[1] TRUE\n\n$value\n[1] \"meters\"\n\n\nLes variables principales\nNous avons quatre variables stockées dans le fichier :\n\nsst : la température quotidienne de la surface de l’eau\nanom : les anomalies quotidiennes de température de surface de l’eau\nerr : estimated error standard deviation of analysed_sst\nice : la concentration en glace\n\n\n(nc_var &lt;- names(nc$var))\n\n[1] \"sst\"  \"anom\" \"err\"  \"ice\" \n\n# get info about variable attribute\nget_var_attribute &lt;- function(var, attribute) {\n  nc_var &lt;- names(nc$var)\n  if (!(var %in% nc_var)) {\n    message(paste(\"la variable\", var, \"est inexistante\"))\n  } else {\n  ln &lt;- ncatt_get(nc, var, attname = attribute)\n  ifelse(ln$hasatt, ln$value, paste(\"pas d'attribut \", attribute))\n  }\n}\n\n# long names\nget_var_long_name &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"long_name\"\n  )\n}\n((get_var_long_name()))\n\n                                                 sst \n                     \"Daily sea surface temperature\" \n                                                anom \n           \"Daily sea surface temperature anomalies\" \n                                                 err \n\"Estimated error standard deviation of analysed_sst\" \n                                                 ice \n                             \"Sea ice concentration\" \n\n# source\nget_var_units &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"units\"\n  )\n}\n((get_var_units()))\n\n      sst      anom       err       ice \n\"Celsius\" \"Celsius\" \"Celsius\"       \"%\" \n\n# fill value\nget_var_fill_value &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = numeric(1), \n  \"_FillValue\"\n  )\n}\n((get_var_fill_value()))\n\n sst anom  err  ice \n-999 -999 -999 -999 \n\n\nLes attributs globaux du fichier\n\natt &lt;- c(\"title\", \"institution\", \"source\", \"references\", \"history\", \"Conventions\") \nget_global_attribute &lt;- function(att) {\n  ncatt_get(nc, 0, att)$value\n}\n(global_attributes &lt;- vapply(att, get_global_attribute, FUN.VALUE = character(1)))\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \"NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  institution \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \"NOAA/National Centers for Environmental Information\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       source \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \"ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   references \n\"Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \"Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Conventions \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \"CF-1.6, ACDD-1.3\""
  },
  {
    "objectID": "sst_example.html#exploration-des-variables",
    "href": "sst_example.html#exploration-des-variables",
    "title": "\n3  Données SST du 15 janvier 2024\n",
    "section": "\n3.2 Exploration des variables",
    "text": "3.2 Exploration des variables\n\nnc_var &lt;- names(nc$var)\n\nnc_charge_var &lt;- function(var) {\n  nc_var &lt;- ncvar_get(nc = nc, varid = var )\n  envir &lt;- globalenv()\n  assign(var, nc_var, envir = envir)\n}\n\nwalk(nc_var, nc_charge_var)\n\nLa variable sst est enregistrée en tant que matrix, array avec les dimensions 1440, 720\nLa valeur enregistrée aux coordonnées [800, 500] vaut sst[800, 500] = 15.7199996\nElle correspond normalement à la température pour la longitude lon[800] = 199.875 et la latitude lat[500] = 34.875\n\nlon_800 &lt;- lon[800]\nlat_500 &lt;- lat[500]\nlonlat &lt;- expand.grid(lon, lat)\ntmp_sst &lt;- as.vector(sst)\ndf_sst &lt;- cbind(lonlat, tmp_sst)\nnames(df_sst) &lt;- c(\"lon\", \"lat\", \"sst\")\nhead(df_sst)\n\n    lon     lat sst\n1 0.125 -89.875  NA\n2 0.375 -89.875  NA\n3 0.625 -89.875  NA\n4 0.875 -89.875  NA\n5 1.125 -89.875  NA\n6 1.375 -89.875  NA\n\ndf_sst |&gt; dplyr::filter(lon == lon_800 & lat == lat_500) -&gt; df_sst_800_500"
  },
  {
    "objectID": "sst_example.html#affichage-de-la-carte-des-données-sst",
    "href": "sst_example.html#affichage-de-la-carte-des-données-sst",
    "title": "\n3  Données SST du 15 janvier 2024\n",
    "section": "\n3.3 Affichage de la carte des données sst",
    "text": "3.3 Affichage de la carte des données sst\nAvec positionnement en rouge du point de test donné en exemple :\n\ndf_sst |&gt; \n  ggplot(aes(x = lon, y = lat, color = sst)) + \n  geom_point(size = 0.5) +\n  geom_point(\n    data = df_sst_800_500, \n    aes(x = lon, y = lat),\n    color = \"red\",\n    size = 2)\n\n\n\n\n\nlist_raster &lt;- map(nc_var, \\(x) rast(t(get(x))))\n\n\nwalk(list_raster, \\(x) plot(flip(x, direction = \"vertical\")))"
  }
]