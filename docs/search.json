[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Fichiers NetCDF",
    "section": "",
    "text": "Preface\nThis is a Quarto book.\nTo learn more about Quarto books visit https://quarto.org/docs/books.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "\n1  Introduction\n",
    "section": "",
    "text": "This is a book created from markdown and executable code.\nSee Knuth (1984) for additional discussion of literate programming.\n\n1 + 1\n\n[1] 2\n\n\n\n\n\n\nKnuth, Donald E. 1984. “Literate Programming.” Comput. J. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  },
  {
    "objectID": "oisst.html",
    "href": "oisst.html",
    "title": "\n2  OISST\n",
    "section": "",
    "text": "3 NOAA 0.25-degree Daily Optimum Interpolation Sea Surface Temperature (OISST), Version 2.1\nLes données de l’organisation sont accessibles via NOAA National Centers for Environmental Information]\nD’autres données sont accessibles ici\nOn y trouve par exemple les données SST qui permettent d’avoir accès aux données qui ont permis de générer les graphes temporels tels que Daily Sea Surface Temperature.\n\nlibs &lt;- c(\n  \"httr\",\n  \"tidyverse\",\n  \"terra\",\n  \"ncdf4\",\n  \"tictoc\"\n)\n\n# install missing libraries\ninstalled_libs &lt;- libs %in% rownames(installed.packages())\nif (any(installed_libs == FALSE)) {\n  install.packages(libs[!installed_libs])\n}\n\n#load libraries\ninvisible(lapply(libs, library, character.only = TRUE))\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.2     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.1     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\nterra 1.7.39\n\n\nAttachement du package : 'terra'\n\n\nL'objet suivant est masqué depuis 'package:tidyr':\n\n    extract\n\n\n\nAttachement du package : 'tictoc'\n\n\nLes objets suivants sont masqués depuis 'package:terra':\n\n    shift, size\n\n\nVisite d’un fichier netCDF (exemple trouvé ici)\n\nroot_access &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr\"\n# generate directory strings from \"198109\" until now\nstart_date &lt;- ymd(\"1981-09-01\")\n# periode &lt;- period(1, unit = \"months\")\n\n(valid_number_of_dl_files &lt;- interval(start_date, Sys.Date()) %/% days(1))\n\n[1] 15489\n\nyyyymm &lt;- function(date) {\n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  paste0(annee, if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)))\n}\nyyyymmdd &lt;- function(date) {\n  annee &lt;- year(date)\n  mois &lt;- month(date)\n  jour &lt;- day(date)\n  paste0(\n    annee,\n    if_else(mois &gt; 9, as.character(mois), paste0(\"0\", mois)),\n    if_else(jour &gt; 9, as.character(jour), paste0(\"0\", jour))\n  )\n}\n\nseq_days &lt;- seq(\n  start_date,\n  Sys.Date() - days(15),\n  by = \"days\"\n)\n\n# liste des fichiers à télécharger\n# \n# possibilité 1 - par concaténation\n\noisst_file_concat &lt;- function(date) {\n  root_access &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr\"\n  dir &lt;- yyyymm(date)\n  file_prefixe &lt;- \"oisst-avhrr-v02r01\"\n  file_suffixe &lt;- \"nc\"\n  file &lt;- paste(file_prefixe, yyyymmdd(date), file_suffixe, sep = \".\")\n  paste(root_access, dir, file, sep = \"/\")\n}\n\ntic(msg = \"sequence de fichiers version 1\")\nseq_oisst_files_v1 &lt;- vapply(seq_days, oisst_file_concat, character(1))\ntoc()\n\nsequence de fichiers version 1: 5.83 sec elapsed\n\n# possibilité 2 - par substitution (expressions régulières)\n\noisst_file_sub &lt;- function(date) {\n  chaine_matrice &lt;- \"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/@/oisst-avhrr-v02r01.&.nc\"\n  sub(\"@\", yyyymm(date), sub(\"&\", yyyymmdd(date), chaine_matrice))\n}\n\ntic(msg = \"sequence de fichiers version 2\")\nseq_oisst_files_v2 &lt;- vapply(seq_days, oisst_file_sub, character(1))\ntoc()\n\nsequence de fichiers version 2: 5.79 sec elapsed\n\nget_oisst_data &lt;- function(date) {\n  link &lt;- oisst_file_sub(date)\n  link_split &lt;- strsplit(link, '/')[[1]]\n  file_name &lt;- link_split[length(link_split)]\n  res &lt;- httr::GET(\n    link,\n    write_disk(\n      paste(\"DATA\", file_name, sep = \"/\"),\n      overwrite = TRUE),\n    progress()\n  )\n}\n\n#walk(seq_days, get_oisst_data)\n\n\n# open netCDF file\nnc &lt;- nc_open(\"DATA/oisst-avhrr-v02r01.20240106.nc\")\n\n\n# get info about latitudes\nlat &lt;- ncvar_get(nc, \"lat\")\nlat_units &lt;- ncatt_get(nc, \"lat\", \"units\")\n# get info about longitudes\nlon &lt;- ncvar_get(nc, \"lon\")\nlon_units &lt;- ncatt_get(nc, \"lon\", \"units\")\n# get info about time\ntime &lt;- ncvar_get(nc, \"time\")\ntime_units &lt;- ncatt_get(nc, \"time\", \"units\")\ntime_as_date &lt;- as.Date(time, origin = \"1978-01-01 12:00:0\", tz = \"UTC\")\n# get info about zlev\nzlev &lt;- ncvar_get(nc, \"zlev\")\nzlev_units &lt;- ncatt_get(nc, \"zlev\", \"units\")\n\n\nnc_var &lt;- names(nc$var)\nprint(paste(\"Variables disponibles :\", paste(nc_var, collapse = ',')))\n\n[1] \"Variables disponibles : sst,anom,err,ice\"\n\n# get info about variable attribute\nget_var_attribute &lt;- function(var, attribute) {\n  nc_var &lt;- names(nc$var)\n  if (!(var %in% nc_var)) {\n    message(paste(\"la variable\", var, \"est inexistante\"))\n  } else {\n  ln &lt;- ncatt_get(nc, var, attname = attribute)\n  ifelse(ln$hasatt, ln$value, paste(\"pas d'attribut \", attribute))\n  }\n}\n\n# long names\nget_var_long_name &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"long_name\"\n  )\n}\nprint(get_var_long_name())\n\n                                                 sst \n                     \"Daily sea surface temperature\" \n                                                anom \n           \"Daily sea surface temperature anomalies\" \n                                                 err \n\"Estimated error standard deviation of analysed_sst\" \n                                                 ice \n                             \"Sea ice concentration\" \n\n# source\nget_var_units &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = character(1), \n  \"units\"\n  )\n}\nprint(get_var_units())\n\n      sst      anom       err       ice \n\"Celsius\" \"Celsius\" \"Celsius\"       \"%\" \n\n# fill value\nget_var_fill_value &lt;- function() {\n  vapply(\n  nc_var, \n  get_var_attribute, \n  FUN.VALUE = numeric(1), \n  \"_FillValue\"\n  )\n}\nprint(get_var_fill_value())\n\n sst anom  err  ice \n-999 -999 -999 -999 \n\n\n\natt &lt;- c(\"title\", \"institution\", \"source\", \"references\", \"history\", \"Conventions\") \nget_global_attribute &lt;- function(att) {\n  ncatt_get(nc, 0, att)$value\n}\nglobal_attributes &lt;- vapply(att, get_global_attribute, FUN.VALUE = character(1))\nprint(global_attributes)\n\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \"NOAA/NCEI 1/4 Degree Daily Optimum Interpolation Sea Surface Temperature (OISST) Analysis, Version 2.1 - Final\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  institution \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \"NOAA/National Centers for Environmental Information\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       source \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \"ICOADS, NCEP_GTS, GSFC_ICE, NCEP_ICE, Pathfinder_AVHRR, Navy_AVHRR, NOAA_ACSP\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   references \n\"Reynolds, et al.(2007) Daily High-Resolution-Blended Analyses for Sea Surface Temperature (available at https://doi.org/10.1175/2007JCLI1824.1). Banzon, et al.(2016) A long-term record of blended satellite and in situ sea-surface temperature for climate monitoring, modeling and environmental studies (available at https://doi.org/10.5194/essd-8-165-2016). Huang et al. (2020) Improvements of the Daily Optimum Interpolation Sea Surface Temperature (DOISST) Version v02r01, submitted.Climatology is based on 1971-2000 OI.v2 SST. Satellite data: Pathfinder AVHRR SST, Navy AVHRR SST, and NOAA ACSPO SST. Ice data: NCEP Ice and GSFC Ice.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      history \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  \"Final file created using preliminary as first guess, and 3 days of AVHRR data. Preliminary uses only 1 day of AVHRR data.\" \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Conventions \n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \"CF-1.6, ACDD-1.3\" \n\n\n\nnc_var &lt;- names(nc$var)\n\nnc_charge_var &lt;- function(var) {\n  nc_var &lt;- ncvar_get(nc = nc, varid = var )\n  envir &lt;- globalenv()\n  assign(var, nc_var, envir = envir)\n}\n\nwalk(nc_var, nc_charge_var)\n\n\nlonlat &lt;- expand.grid(lon, lat)\ntmp_sst &lt;- as.vector(sst)\ndf_sst &lt;- cbind(lonlat, tmp_sst)\nnames(df_sst) &lt;- c(\"lon\", \"lat\", \"sst\")\nhead(df_sst)\n\n    lon     lat sst\n1 0.125 -89.875  NA\n2 0.375 -89.875  NA\n3 0.625 -89.875  NA\n4 0.875 -89.875  NA\n5 1.125 -89.875  NA\n6 1.375 -89.875  NA\n\ndf_sst |&gt; \n  ggplot(aes(x = lon, y = lat, color = sst)) + geom_point(size = 0.5)\n\n\n\n\n\nlist_raster &lt;- map(nc_var, \\(x) rast(t(get(x))))\n\n\nwalk(list_raster, \\(x) plot(flip(x, direction = \"vertical\")))"
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "\n3  Summary\n",
    "section": "",
    "text": "In summary, this book has no content whatsoever.\n\n1 + 1\n\n[1] 2"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Knuth, Donald E. 1984. “Literate Programming.” Comput.\nJ. 27 (2): 97–111. https://doi.org/10.1093/comjnl/27.2.97."
  }
]